{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Incidents",
  "description": "Journal des incidents et résolutions",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Identifiant unique de l'incident"
    },
    "date": {
      "type": "string",
      "format": "date-time",
      "description": "Date et heure de détection"
    },
    "type": {
      "type": "string",
      "enum": ["webhook_failure", "api_error", "capacity_overflow", "payment_failed", "sms_delivery_error", "ads_sync_error", "other"],
      "description": "Type d'incident"
    },
    "severity": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"],
      "description": "Niveau de gravité"
    },
    "service": {
      "type": "string",
      "description": "Service affecté (ex: stripe, facebook, sms)"
    },
    "description": {
      "type": "string",
      "description": "Description de l'incident"
    },
    "status": {
      "type": "string",
      "enum": ["open", "investigating", "resolved", "closed"],
      "description": "Statut de l'incident"
    },
    "detected_by": {
      "type": "string",
      "enum": ["auto", "manual"],
      "description": "Mode de détection"
    },
    "resolution": {
      "type": "string",
      "description": "Description de la résolution"
    },
    "resolved_at": {
      "type": "string",
      "format": "date-time"
    },
    "duration_minutes": {
      "type": "integer",
      "description": "Durée de l'incident en minutes"
    },
    "impact": {
      "type": "string",
      "description": "Impact sur le business"
    },
    "related_ids": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "IDs liés (leads, customers, etc.)"
    }
  },
  "required": ["date", "type", "severity", "service", "description", "status"]
}

